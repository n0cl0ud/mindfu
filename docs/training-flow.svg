<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 2100" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
<defs>
  <linearGradient id="bg2" x1="0" y1="0" x2="0.3" y2="1">
    <stop offset="0%" stop-color="#0a0e1a"/>
    <stop offset="50%" stop-color="#0d1220"/>
    <stop offset="100%" stop-color="#0a0f1e"/>
  </linearGradient>
  <linearGradient id="g2Green" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#00d2a0"/><stop offset="100%" stop-color="#00b894"/>
  </linearGradient>
  <linearGradient id="g2Blue" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#4facfe"/><stop offset="100%" stop-color="#3b82f6"/>
  </linearGradient>
  <linearGradient id="g2Purple" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#a78bfa"/><stop offset="100%" stop-color="#7c3aed"/>
  </linearGradient>
  <linearGradient id="g2Orange" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/>
  </linearGradient>
  <linearGradient id="g2Red" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#fb7185"/><stop offset="100%" stop-color="#e11d48"/>
  </linearGradient>
  <linearGradient id="g2Cyan" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#22d3ee"/><stop offset="100%" stop-color="#06b6d4"/>
  </linearGradient>
  <linearGradient id="g2Gray" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#64748b"/><stop offset="100%" stop-color="#475569"/>
  </linearGradient>
  <linearGradient id="g2Teal" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#2dd4bf"/><stop offset="100%" stop-color="#14b8a6"/>
  </linearGradient>
  <linearGradient id="g2Pink" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#f472b6"/><stop offset="100%" stop-color="#ec4899"/>
  </linearGradient>

  <filter id="gG" x="-30%" y="-30%" width="160%" height="160%"><feGaussianBlur stdDeviation="5" result="b"/><feFlood flood-color="#00d2a0" flood-opacity="0.3"/><feComposite in2="b" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
  <filter id="gB" x="-30%" y="-30%" width="160%" height="160%"><feGaussianBlur stdDeviation="5" result="b"/><feFlood flood-color="#4facfe" flood-opacity="0.3"/><feComposite in2="b" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
  <filter id="gP" x="-30%" y="-30%" width="160%" height="160%"><feGaussianBlur stdDeviation="5" result="b"/><feFlood flood-color="#a78bfa" flood-opacity="0.3"/><feComposite in2="b" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
  <filter id="gO" x="-30%" y="-30%" width="160%" height="160%"><feGaussianBlur stdDeviation="5" result="b"/><feFlood flood-color="#fbbf24" flood-opacity="0.35"/><feComposite in2="b" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
  <filter id="gR" x="-30%" y="-30%" width="160%" height="160%"><feGaussianBlur stdDeviation="5" result="b"/><feFlood flood-color="#fb7185" flood-opacity="0.3"/><feComposite in2="b" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
  <filter id="gT" x="-30%" y="-30%" width="160%" height="160%"><feGaussianBlur stdDeviation="5" result="b"/><feFlood flood-color="#2dd4bf" flood-opacity="0.3"/><feComposite in2="b" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
  <filter id="gPk" x="-30%" y="-30%" width="160%" height="160%"><feGaussianBlur stdDeviation="5" result="b"/><feFlood flood-color="#f472b6" flood-opacity="0.3"/><feComposite in2="b" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
  <filter id="sc" x="-5%" y="-5%" width="110%" height="115%"><feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.35"/></filter>
  <filter id="ss" x="-8%" y="-10%" width="116%" height="120%"><feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.25"/></filter>

  <marker id="a2" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><path d="M 0 1 L 10 5 L 0 9 z" fill="#475569"/></marker>
  <marker id="a2g" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><path d="M 0 1 L 10 5 L 0 9 z" fill="#00d2a0"/></marker>
  <marker id="a2o" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><path d="M 0 1 L 10 5 L 0 9 z" fill="#fbbf24"/></marker>
  <marker id="a2r" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><path d="M 0 1 L 10 5 L 0 9 z" fill="#fb7185"/></marker>
  <marker id="a2d" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><path d="M 0 1 L 10 5 L 0 9 z" fill="#334155"/></marker>
  <marker id="a2b" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><path d="M 0 1 L 10 5 L 0 9 z" fill="#4facfe"/></marker>

  <pattern id="dots2" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse">
    <circle cx="15" cy="15" r="0.7" fill="#1e293b" opacity="0.6"/>
  </pattern>
</defs>

<!-- ========== LAYER 0: BACKGROUND ========== -->
<rect width="1600" height="2100" fill="url(#bg2)"/>
<rect width="1600" height="2100" fill="url(#dots2)"/>
<text x="800" y="48" text-anchor="middle" fill="#e2e8f0" font-size="28" font-weight="700" letter-spacing="1">TRAINING PIPELINE</text>
<text x="800" y="74" text-anchor="middle" fill="#64748b" font-size="14" letter-spacing="3" font-weight="500">MINDFU &#x2022; QLoRA FINE-TUNING FLOW</text>
<line x1="85" y1="100" x2="85" y2="2050" stroke="#1e293b" stroke-width="2"/>

<!-- ========== LAYER 1: ALL PANEL BACKGROUNDS (drawn first, nothing hidden) ========== -->
<!-- Phase 1 panel -->
<rect x="200" y="210" width="1200" height="265" rx="18" fill="#0f1b2d" stroke="#fbbf2433" stroke-width="1.5" filter="url(#sc)"/>
<!-- Phase 2 panel -->
<rect x="200" y="500" width="1200" height="155" rx="18" fill="#0f1b2d" stroke="#00d2a033" stroke-width="1.5" filter="url(#sc)"/>
<!-- Phase 3 panel -->
<rect x="200" y="680" width="1200" height="190" rx="18" fill="#0f1b2d" stroke="#3b82f633" stroke-width="1.5" filter="url(#sc)"/>
<!-- Phase 4 panel -->
<rect x="200" y="895" width="1200" height="140" rx="18" fill="#0f1b2d" stroke="#e11d4833" stroke-width="1.5" filter="url(#sc)"/>
<!-- Phase 5 panel -->
<rect x="200" y="1060" width="880" height="265" rx="18" fill="#0f1b2d" stroke="#ec489933" stroke-width="1.5" filter="url(#sc)"/>
<!-- MLflow panel -->
<rect x="1110" y="1060" width="280" height="200" rx="14" fill="#0f1b2d" stroke="#fbbf2433" stroke-width="1.5" filter="url(#sc)"/>
<!-- Phase 6 panel -->
<rect x="200" y="1350" width="900" height="255" rx="18" fill="#0f1b2d" stroke="#14b8a633" stroke-width="1.5" filter="url(#sc)"/>
<!-- Phase 7 panel -->
<rect x="200" y="1630" width="1200" height="135" rx="18" fill="#0f1b2d" stroke="#06b6d433" stroke-width="1.5" filter="url(#sc)"/>
<!-- Deployment panel -->
<rect x="680" y="1810" width="390" height="100" rx="18" fill="#0f1b2d" stroke="#3b82f655" stroke-width="2" filter="url(#sc)"/>

<!-- ========== LAYER 2: ALL CONNECTION PATHS ========== -->
<!-- PostgreSQL -> Phase 1 -->
<path d="M 800 180 L 800 230" stroke="#475569" stroke-width="2" marker-end="url(#a2)" fill="none"/>
<!-- Phase 1 flow: Export -> Filter -> Split -->
<path d="M 590 275 L 680 275" stroke="#fbbf24" stroke-width="2" marker-end="url(#a2o)" fill="none"/>
<path d="M 920 275 L 1010 275" stroke="#fbbf24" stroke-width="2" marker-end="url(#a2o)" fill="none"/>
<!-- Phase 1 to files -->
<path d="M 470 297 L 430 328" stroke="#47556966" stroke-width="1" fill="none"/>
<path d="M 800 297 L 660 328" stroke="#47556966" stroke-width="1" fill="none"/>
<path d="M 1130 297 L 890 328" stroke="#00d2a088" stroke-width="1.5" fill="none"/>
<path d="M 1130 297 L 1120 328" stroke="#00d2a088" stroke-width="1" fill="none"/>
<!-- Phase 1 train.json -> Phase 2 diamond -->
<path d="M 890 372 L 890 430 L 550 430 L 550 530" stroke="#00d2a0" stroke-width="2" marker-end="url(#a2g)" fill="none"/>
<!-- Phase 2 diamond -> Chat / Alpaca -->
<path d="M 490 555 L 370 555" stroke="#00d2a0" stroke-width="1.5" marker-end="url(#a2g)" fill="none"/>
<path d="M 610 555 L 740 555" stroke="#00d2a0" stroke-width="1.5" marker-end="url(#a2g)" fill="none"/>
<!-- Chat + Alpaca -> HF Dataset -->
<path d="M 300 585 L 300 610 L 1070 610" stroke="#00d2a0" stroke-width="1.5" fill="none"/>
<path d="M 800 585 L 800 610 L 1070 610" stroke="#00d2a0" stroke-width="1.5" fill="none"/>
<path d="M 1070 610 L 1095 610" stroke="#00d2a0" stroke-width="1.5" marker-end="url(#a2g)" fill="none"/>
<!-- BnB -> Tokenizer arrow -->
<path d="M 480 740 L 518 740" stroke="#a78bfa" stroke-width="1.5" fill="none" marker-end="url(#a2d)"/>
<!-- Tokenizer + Model -> k-bit -->
<path d="M 920 775 L 920 800 L 1050 800" stroke="#475569" stroke-width="2" marker-end="url(#a2)" fill="none"/>
<path d="M 640 775 L 640 800 L 1050 800" stroke="#475569" stroke-width="1.5" fill="none"/>
<!-- k-bit -> LoRA (Phase 3 -> Phase 4) -->
<path d="M 1200 845 L 1200 895 L 1050 895 L 1050 925" stroke="#a78bfa" stroke-width="1.5" fill="none"/>
<!-- LoRA config -> get_peft -->
<path d="M 620 960 L 700 960" stroke="#fb7185" stroke-width="2" marker-end="url(#a2r)" fill="none"/>
<!-- get_peft -> SFTTrainer (Phase 4 -> Phase 5) -->
<path d="M 860 1000 L 860 1050 L 760 1050 L 760 1095" stroke="#fb7185" stroke-width="1.5" fill="none"/>
<!-- Training args -> SFTTrainer -->
<path d="M 580 1130 L 638 1130" stroke="#f472b6" stroke-width="2" fill="none" marker-end="url(#a2d)"/>
<!-- HF Dataset -> SFTTrainer (dashed, routed right) -->
<path d="M 1200 635 L 1200 660 L 1440 660 L 1440 1115 L 1000 1115" stroke="#fb718555" stroke-width="1.5" stroke-dasharray="6,4" fill="none"/>
<!-- SFTTrainer -> Training execution -->
<path d="M 820 1175 L 820 1200" stroke="#f472b6" stroke-width="2" fill="none" marker-end="url(#a2d)"/>
<!-- MLflow dashed -->
<path d="M 1080 1240 L 1130 1220" stroke="#fbbf24" stroke-width="1" stroke-dasharray="5,4" fill="none" opacity="0.5"/>
<!-- Training -> Save (Phase 5 -> Phase 6) -->
<path d="M 820 1290 L 820 1360 L 500 1360 L 500 1385" stroke="#475569" stroke-width="2" fill="none" marker-end="url(#a2)"/>
<!-- Save LoRA -> Merge -> Full -->
<path d="M 500 1443 L 500 1460" stroke="#2dd4bf" stroke-width="2" marker-end="url(#a2d)" fill="none"/>
<path d="M 500 1518 L 500 1535" stroke="#2dd4bf" stroke-width="2" marker-end="url(#a2d)" fill="none"/>
<!-- Phase 6 -> Phase 7 -->
<path d="M 500 1590 L 500 1640 L 500 1660" stroke="#475569" stroke-width="2" fill="none"/>
<!-- Phase 7 vLLM -> Deployment -->
<path d="M 875 1735 L 875 1810" stroke="#4facfe" stroke-width="2.5" marker-end="url(#a2b)" fill="none"/>

<!-- ========== LAYER 3: PHASE BADGES + LABELS (always on top of panels) ========== -->
<!-- Phase 0 badge -->
<g transform="translate(60,110)">
  <circle cx="25" cy="14" r="18" fill="#475569" stroke="#64748b" stroke-width="1.5"/>
  <text x="25" y="18" text-anchor="middle" fill="#e2e8f0" font-size="14" font-weight="800">0</text>
</g>
<text x="125" y="128" fill="#64748b" font-size="13" font-weight="700" letter-spacing="1">DATA SOURCE</text>
<!-- Phase 1 badge -->
<g transform="translate(60,220)">
  <circle cx="25" cy="14" r="18" fill="url(#g2Orange)" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="25" y="19" text-anchor="middle" fill="#451a03" font-size="14" font-weight="800">1</text>
</g>
<text x="125" y="238" fill="#fbbf24" font-size="13" font-weight="700" letter-spacing="1">DATA PREPARATION</text>
<!-- Phase 2 badge -->
<g transform="translate(60,510)">
  <circle cx="25" cy="14" r="18" fill="url(#g2Green)" stroke="#00d2a0" stroke-width="1.5"/>
  <text x="25" y="19" text-anchor="middle" fill="#022c22" font-size="14" font-weight="800">2</text>
</g>
<text x="125" y="528" fill="#00d2a0" font-size="13" font-weight="700" letter-spacing="1">DATASET FORMATTING</text>
<!-- Phase 3 badge -->
<g transform="translate(60,690)">
  <circle cx="25" cy="14" r="18" fill="url(#g2Blue)" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="25" y="19" text-anchor="middle" fill="#fff" font-size="14" font-weight="800">3</text>
</g>
<text x="125" y="708" fill="#4facfe" font-size="13" font-weight="700" letter-spacing="1">MODEL SETUP</text>
<!-- Phase 4 badge -->
<g transform="translate(60,905)">
  <circle cx="25" cy="14" r="18" fill="url(#g2Red)" stroke="#e11d48" stroke-width="1.5"/>
  <text x="25" y="19" text-anchor="middle" fill="#fff" font-size="14" font-weight="800">4</text>
</g>
<text x="125" y="923" fill="#fb7185" font-size="13" font-weight="700" letter-spacing="1">LoRA CONFIGURATION</text>
<!-- Phase 5 badge -->
<g transform="translate(60,1070)">
  <circle cx="25" cy="14" r="18" fill="url(#g2Pink)" stroke="#ec4899" stroke-width="1.5"/>
  <text x="25" y="19" text-anchor="middle" fill="#fff" font-size="14" font-weight="800">5</text>
</g>
<text x="125" y="1088" fill="#f472b6" font-size="13" font-weight="700" letter-spacing="1">TRAINING LOOP</text>
<!-- Phase 6 badge -->
<g transform="translate(60,1360)">
  <circle cx="25" cy="14" r="18" fill="url(#g2Teal)" stroke="#14b8a6" stroke-width="1.5"/>
  <text x="25" y="19" text-anchor="middle" fill="#022c22" font-size="14" font-weight="800">6</text>
</g>
<text x="125" y="1378" fill="#2dd4bf" font-size="13" font-weight="700" letter-spacing="1">MODEL SAVING</text>
<!-- Phase 7 badge -->
<g transform="translate(60,1640)">
  <circle cx="25" cy="14" r="18" fill="url(#g2Cyan)" stroke="#06b6d4" stroke-width="1.5"/>
  <text x="25" y="19" text-anchor="middle" fill="#083344" font-size="14" font-weight="800">7</text>
</g>
<text x="125" y="1658" fill="#22d3ee" font-size="13" font-weight="700" letter-spacing="1">EXPORT OPTIONS</text>

<!-- ========== LAYER 4: ALL CONTENT NODES (always on top) ========== -->

<!-- === Phase 0: PostgreSQL === -->
<g filter="url(#ss)" transform="translate(720,105)">
  <ellipse cx="80" cy="10" rx="80" ry="14" fill="#475569"/>
  <rect x="0" y="10" width="160" height="50" fill="#3b4d63"/>
  <ellipse cx="80" cy="60" rx="80" ry="14" fill="#334155"/>
  <ellipse cx="80" cy="10" rx="80" ry="14" fill="#64748b"/>
  <text x="80" y="32" text-anchor="middle" fill="#e2e8f0" font-size="14" font-weight="700">PostgreSQL</text>
  <text x="80" y="50" text-anchor="middle" fill="#94a3b8" font-size="10">conversations &#x2022; messages &#x2022; quality scores</text>
</g>

<!-- === Phase 1: Data Preparation === -->
<g filter="url(#ss)">
  <rect x="350" y="250" width="240" height="48" rx="10" fill="url(#g2Orange)" filter="url(#gO)" opacity="0.9"/>
  <text x="470" y="271" text-anchor="middle" fill="#451a03" font-size="13" font-weight="700">Export conversations</text>
  <text x="470" y="286" text-anchor="middle" fill="#78350f" font-size="10">SQL + date range + quality filter</text>
</g>
<g filter="url(#ss)">
  <rect x="680" y="250" width="240" height="48" rx="10" fill="url(#g2Orange)" filter="url(#gO)" opacity="0.9"/>
  <text x="800" y="271" text-anchor="middle" fill="#451a03" font-size="13" font-weight="700">Quality filtering</text>
  <text x="800" y="286" text-anchor="middle" fill="#78350f" font-size="10">2-20 turns &#x2022; min 50 chars &#x2022; no empty</text>
</g>
<g filter="url(#ss)">
  <rect x="1010" y="250" width="240" height="48" rx="10" fill="url(#g2Orange)" filter="url(#gO)" opacity="0.9"/>
  <text x="1130" y="271" text-anchor="middle" fill="#451a03" font-size="13" font-weight="700">Train / Val split</text>
  <text x="1130" y="286" text-anchor="middle" fill="#78350f" font-size="10">90% / 10% &#x2022; seed=42</text>
</g>
<!-- Output files -->
<g filter="url(#ss)">
  <rect x="340" y="330" width="180" height="42" rx="8" fill="#1e293b" stroke="#475569" stroke-width="1"/>
  <text x="430" y="349" text-anchor="middle" fill="#94a3b8" font-size="10" font-weight="600">raw/conversations.json</text>
  <text x="430" y="364" text-anchor="middle" fill="#64748b" font-size="9">all exported</text>
</g>
<g filter="url(#ss)">
  <rect x="570" y="330" width="180" height="42" rx="8" fill="#1e293b" stroke="#475569" stroke-width="1"/>
  <text x="660" y="349" text-anchor="middle" fill="#94a3b8" font-size="10" font-weight="600">filtered/filtered.json</text>
  <text x="660" y="364" text-anchor="middle" fill="#64748b" font-size="9">quality checked</text>
</g>
<g filter="url(#ss)">
  <rect x="800" y="330" width="180" height="42" rx="8" fill="#00b894" stroke="#00d2a0" stroke-width="1"/>
  <text x="890" y="349" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">splits/train.json</text>
  <text x="890" y="364" text-anchor="middle" fill="#d1fae5" font-size="9">90% training data</text>
</g>
<g filter="url(#ss)">
  <rect x="1030" y="330" width="180" height="42" rx="8" fill="#1e293b" stroke="#00d2a0" stroke-width="1"/>
  <text x="1120" y="349" text-anchor="middle" fill="#00d2a0" font-size="10" font-weight="600">splits/validation.json</text>
  <text x="1120" y="364" text-anchor="middle" fill="#64748b" font-size="9">10% validation</text>
</g>

<!-- === Phase 2: Dataset Formatting === -->
<!-- Detect diamond -->
<g filter="url(#ss)">
  <polygon points="550,530 610,555 550,580 490,555" fill="#1e293b" stroke="#00d2a0" stroke-width="1.5"/>
  <text x="550" y="553" text-anchor="middle" fill="#a7f3d0" font-size="10" font-weight="700">DETECT</text>
  <text x="550" y="565" text-anchor="middle" fill="#a7f3d0" font-size="10" font-weight="700">FORMAT</text>
</g>
<!-- Labels on arrows -->
<text x="435" y="548" text-anchor="middle" fill="#00d2a0" font-size="10" font-weight="600">Chat</text>
<text x="670" y="548" text-anchor="middle" fill="#00d2a0" font-size="10" font-weight="600">Alpaca</text>
<!-- Chat format box -->
<g filter="url(#ss)">
  <rect x="240" y="530" width="130" height="50" rx="10" fill="url(#g2Green)" filter="url(#gG)" opacity="0.9"/>
  <text x="305" y="552" text-anchor="middle" fill="#fff" font-size="11" font-weight="700">Chat format</text>
  <text x="305" y="567" text-anchor="middle" fill="#d1fae5" font-size="9">System/User/Assist</text>
</g>
<!-- Alpaca format box -->
<g filter="url(#ss)">
  <rect x="740" y="530" width="130" height="50" rx="10" fill="url(#g2Green)" filter="url(#gG)" opacity="0.9"/>
  <text x="805" y="552" text-anchor="middle" fill="#fff" font-size="11" font-weight="700">Alpaca format</text>
  <text x="805" y="567" text-anchor="middle" fill="#d1fae5" font-size="9">Instruct/Input/Resp</text>
</g>
<!-- HF Dataset box -->
<g filter="url(#ss)">
  <rect x="1095" y="585" width="220" height="50" rx="10" fill="url(#g2Red)" filter="url(#gR)" opacity="0.9"/>
  <text x="1205" y="607" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">HuggingFace Dataset</text>
  <text x="1205" y="623" text-anchor="middle" fill="#fecdd3" font-size="10">field: "text"</text>
</g>

<!-- === Phase 3: Model Setup === -->
<!-- BitsAndBytes -->
<g filter="url(#ss)">
  <rect x="240" y="710" width="240" height="62" rx="10" fill="url(#g2Purple)" filter="url(#gP)" opacity="0.9"/>
  <text x="360" y="732" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">BitsAndBytes config</text>
  <text x="360" y="748" text-anchor="middle" fill="#ede9fe" font-size="10">4-bit NF4 &#x2022; double quant</text>
  <text x="360" y="762" text-anchor="middle" fill="#ede9fe" font-size="10">bfloat16 compute dtype</text>
</g>
<!-- Tokenizer -->
<g filter="url(#ss)">
  <rect x="520" y="710" width="240" height="62" rx="10" fill="url(#g2Gray)" opacity="0.85"/>
  <text x="640" y="732" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">Load tokenizer</text>
  <text x="640" y="748" text-anchor="middle" fill="#cbd5e0" font-size="10">3-stage fallback chain</text>
  <text x="640" y="762" text-anchor="middle" fill="#94a3b8" font-size="10">pad_token = eos &#x2022; right padding</text>
</g>
<!-- Load model -->
<g filter="url(#ss)">
  <rect x="800" y="710" width="240" height="62" rx="10" fill="url(#g2Blue)" filter="url(#gB)" opacity="0.9"/>
  <text x="920" y="732" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">Load Devstral-24B</text>
  <text x="920" y="748" text-anchor="middle" fill="#dbeafe" font-size="10">4-bit quantized &#x2022; ~12 GB VRAM</text>
  <text x="920" y="762" text-anchor="middle" fill="#93c5fd" font-size="10">device_map=auto</text>
</g>
<!-- k-bit training -->
<g filter="url(#ss)">
  <rect x="1050" y="785" width="300" height="58" rx="10" fill="url(#g2Purple)" filter="url(#gP)" opacity="0.9"/>
  <text x="1200" y="808" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">Prepare for k-bit training</text>
  <text x="1200" y="824" text-anchor="middle" fill="#ede9fe" font-size="10">Freeze base weights &#x2022; Float32 embeddings</text>
  <text x="1200" y="838" text-anchor="middle" fill="#ede9fe" font-size="10">Gradient checkpointing enabled</text>
</g>

<!-- === Phase 4: LoRA === -->
<g filter="url(#ss)">
  <rect x="300" y="920" width="320" height="75" rx="10" fill="url(#g2Red)" filter="url(#gR)" opacity="0.9"/>
  <text x="460" y="947" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">LoRA config</text>
  <text x="460" y="964" text-anchor="middle" fill="#fecdd3" font-size="10">rank=16 &#x2022; alpha=32 &#x2022; dropout=0.05</text>
  <text x="460" y="980" text-anchor="middle" fill="#fecdd3" font-size="10">q/k/v/o_proj &#x2022; gate/up/down_proj</text>
</g>
<g filter="url(#ss)">
  <rect x="700" y="920" width="320" height="75" rx="10" fill="url(#g2Red)" filter="url(#gR)" opacity="0.9"/>
  <text x="860" y="947" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">get_peft_model</text>
  <text x="860" y="964" text-anchor="middle" fill="#fecdd3" font-size="10">Wrap with LoRA adapters</text>
  <text x="860" y="980" text-anchor="middle" fill="#fecdd3" font-size="10">~0.5% trainable params &#x2022; bias=none</text>
</g>

<!-- === Phase 5: Training === -->
<!-- Training args -->
<g filter="url(#ss)">
  <rect x="240" y="1090" width="340" height="85" rx="10" fill="url(#g2Gray)" opacity="0.85"/>
  <text x="410" y="1113" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">Training arguments</text>
  <text x="410" y="1130" text-anchor="middle" fill="#cbd5e0" font-size="10">batch=2 &#x2022; grad_accum=8 &#x2022; effective=16</text>
  <text x="410" y="1146" text-anchor="middle" fill="#cbd5e0" font-size="10">lr=2e-4 &#x2022; cosine schedule &#x2022; 3% warmup</text>
  <text x="410" y="1162" text-anchor="middle" fill="#94a3b8" font-size="10">3 epochs &#x2022; paged_adamw_8bit &#x2022; bf16</text>
</g>
<!-- SFTTrainer -->
<g filter="url(#ss)">
  <rect x="640" y="1095" width="360" height="80" rx="12" fill="url(#g2Pink)" filter="url(#gPk)" opacity="0.9"/>
  <text x="820" y="1122" text-anchor="middle" fill="#fff" font-size="15" font-weight="700">SFTTrainer</text>
  <text x="820" y="1140" text-anchor="middle" fill="#fce7f3" font-size="11">Supervised Fine-Tuning &#x2022; max_seq=2048</text>
  <text x="820" y="1156" text-anchor="middle" fill="#fce7f3" font-size="10">model + tokenizer + dataset + args</text>
</g>
<!-- Training execution -->
<g filter="url(#ss)">
  <rect x="500" y="1202" width="520" height="80" rx="12" fill="#2d0f24" stroke="#ec4899" stroke-width="1.5"/>
  <text x="760" y="1230" text-anchor="middle" fill="#f472b6" font-size="14" font-weight="700">Training execution</text>
  <text x="760" y="1248" text-anchor="middle" fill="#fce7f3" font-size="11">Tokenize &#x2192; Forward &#x2192; Loss &#x2192; Backward &#x2192; Accumulate &#x2192; Update</text>
  <text x="760" y="1264" text-anchor="middle" fill="#fce7f3" font-size="10" opacity="0.7">Log metrics every 10 steps &#x2022; checkpoint per epoch</text>
</g>

<!-- === MLflow panel content === -->
<rect x="1160" y="1052" width="180" height="22" rx="11" fill="url(#g2Orange)"/>
<text x="1250" y="1067" text-anchor="middle" fill="#451a03" font-size="10" font-weight="800" letter-spacing="1">MLflow &#x2022; :5000</text>
<g filter="url(#ss)">
  <rect x="1135" y="1088" width="230" height="36" rx="8" fill="#1e293b" stroke="#fbbf2466" stroke-width="1"/>
  <text x="1250" y="1107" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="600">Log parameters</text>
  <text x="1250" y="1120" text-anchor="middle" fill="#94a3b8" font-size="9">model, lora, lr, epochs</text>
</g>
<g filter="url(#ss)">
  <rect x="1135" y="1133" width="230" height="36" rx="8" fill="#1e293b" stroke="#fbbf2466" stroke-width="1"/>
  <text x="1250" y="1152" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="600">Log metrics</text>
  <text x="1250" y="1165" text-anchor="middle" fill="#94a3b8" font-size="9">loss/10 steps, runtime, samples/s</text>
</g>
<g filter="url(#ss)">
  <rect x="1135" y="1178" width="230" height="36" rx="8" fill="#1e293b" stroke="#fbbf2466" stroke-width="1"/>
  <text x="1250" y="1197" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="600">Log artifacts</text>
  <text x="1250" y="1210" text-anchor="middle" fill="#94a3b8" font-size="9">LoRA + merged checkpoints</text>
</g>

<!-- === Phase 6: Model Saving === -->
<g filter="url(#ss)">
  <rect x="350" y="1385" width="300" height="55" rx="10" fill="url(#g2Teal)" filter="url(#gT)" opacity="0.9"/>
  <text x="500" y="1408" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">Save LoRA adapter</text>
  <text x="500" y="1425" text-anchor="middle" fill="#ccfbf1" font-size="10">~150 MB &#x2022; adapter_model.bin + config</text>
</g>
<g filter="url(#ss)">
  <rect x="350" y="1463" width="300" height="55" rx="10" fill="url(#g2Teal)" filter="url(#gT)" opacity="0.9"/>
  <text x="500" y="1486" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">Merge LoRA &#x2192; base</text>
  <text x="500" y="1503" text-anchor="middle" fill="#ccfbf1" font-size="10">W = W_base + A &#xD7; B &#x2022; merge_and_unload()</text>
</g>
<g filter="url(#ss)">
  <rect x="350" y="1538" width="300" height="55" rx="10" fill="url(#g2Teal)" filter="url(#gT)" opacity="0.9"/>
  <text x="500" y="1561" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">Save merged model</text>
  <text x="500" y="1578" text-anchor="middle" fill="#ccfbf1" font-size="10">~48 GB full precision &#x2022; safetensors</text>
</g>
<!-- Size badges -->
<g>
  <rect x="720" y="1395" width="130" height="26" rx="8" fill="#1e293b" stroke="#2dd4bf44" stroke-width="1"/>
  <text x="785" y="1412" text-anchor="middle" fill="#2dd4bf" font-size="11" font-weight="600">~150 MB</text>
</g>
<g>
  <rect x="720" y="1475" width="130" height="26" rx="8" fill="#1e293b" stroke="#2dd4bf44" stroke-width="1"/>
  <text x="785" y="1492" text-anchor="middle" fill="#94a3b8" font-size="11">W_base + A&#xD7;B</text>
</g>
<g>
  <rect x="720" y="1550" width="130" height="26" rx="8" fill="#1e293b" stroke="#2dd4bf44" stroke-width="1"/>
  <text x="785" y="1567" text-anchor="middle" fill="#2dd4bf" font-size="11" font-weight="600">~48 GB</text>
</g>

<!-- === Phase 7: Export Options === -->
<g filter="url(#ss)">
  <rect x="230" y="1655" width="220" height="70" rx="10" fill="url(#g2Gray)" opacity="0.85"/>
  <text x="340" y="1680" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">SafeTensors</text>
  <text x="340" y="1698" text-anchor="middle" fill="#cbd5e0" font-size="10">Faster loading &#x2022; safer format</text>
  <text x="340" y="1713" text-anchor="middle" fill="#94a3b8" font-size="10">Industry standard</text>
</g>
<g filter="url(#ss)">
  <rect x="480" y="1655" width="220" height="70" rx="10" fill="url(#g2Purple)" filter="url(#gP)" opacity="0.85"/>
  <text x="590" y="1680" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">AWQ Quantize</text>
  <text x="590" y="1698" text-anchor="middle" fill="#ede9fe" font-size="10">4-bit &#x2022; group=128</text>
  <text x="590" y="1713" text-anchor="middle" fill="#ede9fe" font-size="10">~12 GB output</text>
</g>
<g filter="url(#ss)">
  <rect x="730" y="1655" width="220" height="70" rx="10" fill="url(#g2Blue)" filter="url(#gB)" opacity="0.9"/>
  <text x="840" y="1680" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">Prepare for vLLM</text>
  <text x="840" y="1698" text-anchor="middle" fill="#dbeafe" font-size="10">Weights + config + deploy.json</text>
  <text x="840" y="1713" text-anchor="middle" fill="#93c5fd" font-size="10">vllm-ready/ directory</text>
</g>
<g filter="url(#ss)">
  <rect x="980" y="1655" width="220" height="70" rx="10" fill="url(#g2Gray)" opacity="0.85"/>
  <text x="1090" y="1680" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">Push to HF Hub</text>
  <text x="1090" y="1698" text-anchor="middle" fill="#cbd5e0" font-size="10">Public or private repo</text>
  <text x="1090" y="1713" text-anchor="middle" fill="#94a3b8" font-size="10">HuggingFace model card</text>
</g>

<!-- === Deployment === -->
<rect x="805" y="1802" width="160" height="22" rx="11" fill="url(#g2Blue)"/>
<text x="885" y="1817" text-anchor="middle" fill="#fff" font-size="11" font-weight="800" letter-spacing="1">DEPLOYMENT</text>
<g filter="url(#ss)">
  <rect x="720" y="1830" width="310" height="56" rx="12" fill="#0c1e3d" stroke="#3b82f6" stroke-width="1.5" filter="url(#gB)"/>
  <text x="875" y="1854" text-anchor="middle" fill="#60a5fa" font-size="16" font-weight="700">vLLM Service</text>
  <text x="875" y="1872" text-anchor="middle" fill="#bfdbfe" font-size="11">Load fine-tuned model &#x2022; Serve on :8000</text>
</g>

<!-- ========== LAYER 5: LEGEND ========== -->
<g transform="translate(60,1940)">
  <rect x="0" y="0" width="500" height="110" rx="14" fill="#0f1b2d" stroke="#1e3a5f" stroke-width="1" filter="url(#sc)"/>
  <text x="250" y="22" text-anchor="middle" fill="#94a3b8" font-size="12" font-weight="700" letter-spacing="1">COLOR LEGEND</text>
  <rect x="20" y="38" width="32" height="12" rx="4" fill="url(#g2Orange)"/>
  <text x="62" y="48" fill="#cbd5e0" font-size="10">Data prep / filtering</text>
  <rect x="20" y="56" width="32" height="12" rx="4" fill="url(#g2Green)"/>
  <text x="62" y="66" fill="#cbd5e0" font-size="10">Formatting / processing</text>
  <rect x="20" y="74" width="32" height="12" rx="4" fill="url(#g2Blue)"/>
  <text x="62" y="84" fill="#cbd5e0" font-size="10">Model loading / deployment</text>
  <rect x="20" y="92" width="32" height="12" rx="4" fill="url(#g2Teal)"/>
  <text x="62" y="102" fill="#cbd5e0" font-size="10">Model saving / merge</text>
  <rect x="260" y="38" width="32" height="12" rx="4" fill="url(#g2Purple)"/>
  <text x="302" y="48" fill="#cbd5e0" font-size="10">Quantization</text>
  <rect x="260" y="56" width="32" height="12" rx="4" fill="url(#g2Red)"/>
  <text x="302" y="66" fill="#cbd5e0" font-size="10">LoRA / HF Dataset</text>
  <rect x="260" y="74" width="32" height="12" rx="4" fill="url(#g2Pink)"/>
  <text x="302" y="84" fill="#cbd5e0" font-size="10">Training execution</text>
  <rect x="260" y="92" width="32" height="12" rx="4" fill="url(#g2Cyan)"/>
  <text x="302" y="102" fill="#cbd5e0" font-size="10">Export options</text>
</g>

<text x="800" y="2085" text-anchor="middle" fill="#334155" font-size="12" font-weight="500" letter-spacing="1">MINDFU &#x2022; TRAINING ARCHITECTURE &#x2022; 2025</text>
</svg>